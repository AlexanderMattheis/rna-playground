<!--
University of Freiburg WS 2017/2018
Chair for Bioinformatics
Supervisor: Martin Raden
Author: Alexander Mattheis
-->

<div id="algorithm_description">
    <div class="description">
        The
        <a href="https://doi.org/10.1016/0022-2836(82)90398-9">Gotoh (1982)</a>
        algorithm by Osamu Gotoh
        computes the optimal, global affine alignment of two sequences.
        The problem with
        <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch (1970)</a>
        was that it does not produce
        biologically relevant alignments and
        the more realistic algorithm
        <a href="https://doi.org/10.1016/0001-8708(76)90202-4">Waterman-Smith-Beyer (1976)</a>
        was too slow. And by this reason a compromise was made.
        <a href="https://doi.org/10.1016/0022-2836(82)90398-9">Gotoh</a>
        is not that realistic like <a href="https://doi.org/10.1016/0001-8708(76)90202-4">Waterman-Smith-Beyer</a>,
        but it has the same asymptotic runtime like
        <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch</a>
        and so it can be used practically.
        <br>
        <br>
        In the
        <a href="https://doi.org/10.1016/0022-2836(82)90398-9">Gotoh</a>
        algorithm, the number of gap starts is minimized
        to get biologically better alignments.
        This done by introducing two additional matrices $P$ and $Q$
        (which are storing the vertical and horizontal gap costs)
        and a new recursion function $D_{i,j}$
        (w.r.t. <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch</a>).
        The asymptotic runtime
        and space consumption
        is however, not higher than in the
        <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch</a>
        algorithm. Runtime and space are in $\mathcal O(nm)$, where $n=|a|$ and $m=|b|$.
    </div>

    <div class="picture">
        <img src="Gotoh-120x90.png">
    </div>
</div>

<div id="algorithm_input">
    <form>
        <p>
            <label>Sequence $a$:</label>
            <input class="sequence" data-bind="value: input.sequence1" id="sequence_1"
                   placeholder="EXAMPLE 'ATC'" type="text">
        </p>

        <p>
            <label>Sequence $b$:</label>
            <input class="sequence" data-bind="value: input.sequence2" id="sequence_2"
                   placeholder="EXAMPLE 'AGTC'" type="text">
        </p>

        <p>
            <label>Calculation:</label>
            <span class="group">
                Distance <input class="optimization_type" data-bind="checked: input.calculation" id="distance"
                                name="calculation" type="radio" value="distance">
                Similarity <input class="optimization_type" data-bind="checked: input.calculation" id="similarity"
                                  name="calculation" type="radio" value="similarity">
            </span>
        </p>

        <p>
            <label>Scoring $s$:</label>
            <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                Match <input class="fx_parameter" data-bind="value: input.match" id="match" type="number">
                Mismatch <input class="fx_parameter" data-bind="value: input.mismatch" id="mismatch" type="number">
                Base Costs $\alpha$ <input class="fx_parameter" data-bind="value: input.baseCosts" id="base_costs" type="number">
                Enlargement $\beta$ <input class="fx_parameter" data-bind="value: input.enlargement" id="enlargement" type="number">
            </span>
        </p>

        <p>
            <label id="recursion_gotoh">Recursions:</label>
            <div class="span_group">
                <span data-bind="text: $root.input.formula"></span>
                <br>
                <br>
                <span data-bind="text: $root.input.formulaP"></span>
                <br>
                <br>
                <span data-bind="text: $root.input.formulaQ"></span>
                <br>
                <br>
                <br>
                <span data-bind="text: $root.input.gapFunction"></span>
            </div>

            <div class="group_hint">
                <b>Hint:</b> <br>
                If similarity is checked,
                then match values should be positive or zero and every other value lower or equal zero. <br>
                And if distance is checked,
                then match values should be negative or zero and every other value higher or equal zero.
            </div>
        </p>
    </form>
</div>

<div id="algorithm_output">
    <div id="main_output">
        <table id="calculation_vertical">
            <thead>
                <tr>
                    <th>$P$</th>
                    <th></th>
                    <!-- ko foreach: input.sequence1 -->
                        <th data-bind="drawChar: [$data, $index()+1]"></th>
                    <!-- /ko -->
                </tr>
            </thead>

            <tbody>
                <!-- ko foreach: output.verticalGaps --> <!-- to get i-indexes = $parentContext.$index() -->
                    <tr>
                        <!-- ko if: $index() == 0 -->
                            <th></th>
                        <!-- /ko -->

                        <!-- ko if: $index() > 0 -->
                            <th data-bind="drawChar: [$root.input.sequence2()[$index()-1], $index()]"></th>
                        <!-- /ko -->

                        <!-- ko foreach: $root.output.matrix[0] --> <!-- to get j-indexes = $index() -->
                            <td class="selectable_entry"
                                data-bind="text: $root.output.verticalGaps()[$parentContext.$index()][$index()]"></td>
                        <!-- /ko -->
                    </tr>
                <!-- /ko -->

                <tr>
                    <th class="hint" colspan=100%>  <!-- HINT: move colspan into hint-class when browsers are ready! -->
                        <small>
                            <b>Score:</b> -
                        </small>
                    </th>
                </tr>
            </tbody>
        </table>

        <br>
        <!-- Firefox bugfix: footer separated from table -->
        <table>
            <tfoot>
                <tr>
                    <td class="download_table" colspan=100%>
                        <a class="table_vertical_download" href="#">Download<br>Table</a>
                    </td>
                </tr>
            </tfoot>
        </table>

        <br>
        <br>
        <br>

        <table id="calculation">
            <thead>
                <tr>
                    <th>$D$</th>
                    <th></th>
                    <!-- ko foreach: input.sequence1 -->
                        <th data-bind="drawChar: [$data, $index()+1]"></th>
                    <!-- /ko -->
                </tr>
            </thead>

            <tbody>
                <!-- ko foreach: output.matrix --> <!-- to get i-indexes = $parentContext.$index() -->
                    <tr>
                        <!-- ko if: $index() == 0 -->
                            <th></th>
                        <!-- /ko -->

                        <!-- ko if: $index() > 0 -->
                            <th data-bind="drawChar: [$root.input.sequence2()[$index()-1], $index()]"></th>
                        <!-- /ko -->

                        <!-- ko foreach: $root.output.matrix[0] --> <!-- to get j-indexes = $index() -->
                            <td class="selectable_entry"
                                data-bind="text: $root.output.matrix()[$parentContext.$index()][$index()]"></td>
                        <!-- /ko -->
                    </tr>
                <!-- /ko -->

                <tr>
                    <th class="hint" colspan=100%>  <!-- HINT: move colspan into hint-class when browsers are ready! -->
                        <small>
                            <b>Score:</b> <span data-bind="text: $root.output.score"></span>
                        </small>
                    </th>
                </tr>
            </tbody>
        </table>

        <br>
        <!-- Firefox bugfix: footer separated from table -->
        <table>
            <tfoot>
                <tr>
                    <td class="download_table" colspan=100%>
                        <a class="table_download" href="#">Download<br>Table</a>
                    </td>
                </tr>
            </tfoot>
        </table>

        <br>
        <br>
        <br>

        <table id="calculation_horizontal">
            <thead>
                <tr>
                    <th>$Q$</th>
                    <th></th>
                    <!-- ko foreach: input.sequence1 -->
                        <th data-bind="drawChar: [$data, $index()+1]"></th>
                    <!-- /ko -->
                </tr>
            </thead>

            <tbody>
                <!-- ko foreach: output.horizontalGaps --> <!-- to get i-indexes = $parentContext.$index() -->
                    <tr>
                        <!-- ko if: $index() == 0 -->
                            <th></th>
                        <!-- /ko -->

                        <!-- ko if: $index() > 0 -->
                            <th data-bind="drawChar: [$root.input.sequence2()[$index()-1], $index()]"></th>
                        <!-- /ko -->

                        <!-- ko foreach: $root.output.matrix[0] --> <!-- to get j-indexes = $index() -->
                        <td class="selectable_entry"
                            data-bind="text: $root.output.horizontalGaps()[$parentContext.$index()][$index()]"></td>
                        <!-- /ko -->
                    </tr>
                <!-- /ko -->

                <tr>
                    <th class="hint" colspan=100%>  <!-- HINT: move colspan into hint-class when browsers are ready! -->
                        <small>
                            <b>Score:</b> -
                        </small>
                    </th>
                </tr>
            </tbody>
        </table>

        <br>
        <!-- Firefox bugfix: footer separated from table -->
        <table>
            <tfoot>
                <tr>
                    <td class="download_table" colspan=100%>
                        <a class="table_horizontal_download" href="#">Download<br>Table</a>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div id="ancillary_output">
        <div id ="outcome">
            <table id="results_header">
                <thead>
                    <tr>
                        <th>
                            Results <br>
                            <small>
                                You can select a result to get the related traceback.
                            </small>
                        </th>
                    </tr>
                </thead>
            </table>

            <div id="results_with_scrollbar">
                <table id="results">
                    <tbody>
                        <!-- ko foreach: $root.output.alignments -->
                            <!-- ko if: $index() < 10 -->
                                <!-- ko if: $index() == 0 -->
                                    <tr>
                                        <td class="selectable_entry selectable_entry_start">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                                <!-- ko if: $index() != 0 -->
                                    <tr>
                                        <td class="selectable_entry">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>

            <table id="results_footer">
                <tr>
                    <th>
                        <small>
                            <!-- ko if: $root.output.moreTracebacks -->
                                <b>Hint:</b> Only the first ten results are computed.
                            <!-- /ko -->
                        </small>
                    </th>
                </tr>
            </table>
        </div>
    </div>
</div>