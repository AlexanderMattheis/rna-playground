<!--
University of Freiburg WS 2017/2018
Chair for Bioinformatics
Supervisor: Martin Raden
Author: Alexander Mattheis
-->

<div id="algorithm_description">
    <div class="description">
        The dynamic programming approach
        <a href="https://doi.org/10.1016/0001-8708(76)90202-4">Waterman-Smith-Beyer (1976)</a>
        by Michael S. Waterman, Temple F. Smith and William. A. Beyer
        computes the optimal, global subadditive alignment of two sequences.
        The problem with
        <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch (1970)</a>
        was that it does not produce
        biologically relevant alignments.
        Alignments had too many gaps
        and by this reason, the
        <a href="https://doi.org/10.1016/0001-8708(76)90202-4">Waterman-Smith-Beyer</a>
        algorithm was introduced.
        <br>
        <br>
        This algorithm is minimizing the number of gap starts
        by using a subadditive gap function.
        Such way you get biologically better results.
        In the algorithm you try to build a large as possible gap with every cell position
        left of the current cell position and with every cell position
        over the current cell position.
        Therefore, you optimize (minimize/maximize) over the possible positions left and up
        of the current position in the matrix.
        So, you have a new recursion function $D_{i,j}$
        (w.r.t. <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch</a>).
        <br>
        <br>
        Apart from that, the algorithm works analogously to
        <a href="https://doi.org/10.1016/0022-2836(70)90057-4">Needleman-Wunsch</a>.
        You initialize a matrix $D$,
        then you fill the matrix with the help of the recursion function $D_{i,j}$.
        And in the last step you do tracebacks to compute the alignments
        of the input-sequences $a$ and $b$. The space costs are in
        $\mathcal O(nm)$, where $n=|a|$ and $m=|b|$, but the runtime is because
        of the optimization over the possible positions in $\mathcal O(n^2m + nm^2)$.
    </div>

    <div class="picture">
        <img src="Waterman-Smith-Beyer-120x90.png">
    </div>
</div>

<div id="algorithm_input">
    <form>
        <p>
            <label>Sequence $a$:</label>
            <input class="sequence" data-bind="value: input.sequence1" id="sequence_1"
                   maxlength="15" placeholder="EXAMPLE 'ATC'" type="text">
        </p>

        <p>
            <label>Sequence $b$:</label>
            <input class="sequence" data-bind="value: input.sequence2" id="sequence_2"
                   maxlength="15" placeholder="EXAMPLE 'AGTC'" type="text">
        </p>

        <p>
            <label>Calculation:</label>
            <span class="group">
                Distance <input class="optimization_type" data-bind="checked: input.calculation" id="distance"
                                name="calculation" type="radio" value="distance">
                Similarity <input class="optimization_type" data-bind="checked: input.calculation" id="similarity"
                                  name="calculation" type="radio" value="similarity">
            </span>
        </p>

        <p>
            <label>Scoring $s$:</label>
            <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                Match <input class="fx_parameter" data-bind="value: input.match" id="match" type="number">
                Mismatch <input class="fx_parameter" data-bind="value: input.mismatch" id="mismatch" type="number">
                Base Costs $\alpha$ <input class="fx_parameter" data-bind="value: input.baseCosts" id="base_costs" type="number">
                Enlargement $\beta$ <input class="fx_parameter" data-bind="value: input.enlargement" id="enlargement" type="number">
            </span>
        </p>

        <p>
            <label>Gap Function $g$:</label>
            <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                Affine <input class="gap_function_type" data-bind="checked: input.subadditiveFunction" id="affine"
                              name="functionGroup" type="radio" value="affine">

                Logarithmic <input class="gap_function_type" data-bind="checked: input.subadditiveFunction" id="logarithmic"
                                   name="functionGroup" type="radio" value="logarithmic">

                Quadratic <input class="gap_function_type" data-bind="checked: input.subadditiveFunction" id="quadratic"
                                 name="functionGroup" type="radio" value="quadratic">
            </span>
        </p>

        <p>
            <label id="recursion_waterman_smith_beyer">Recursions:</label>
            <div class="span_group">
                <span data-bind="text: $root.input.formula"></span>
                <br>
                <br>
                <span data-bind="text: $root.input.gapFunction"></span>
            </div>

            <div class="group_hint">
                <b>Hint:</b> <br>
                If similarity is checked,
                then match values should be positive or zero and every other value lower or equal zero. <br>
                And if distance is checked,
                then match values should be negative or zero and every other value higher or equal zero.
            </div>
        </p>
    </form>
</div>

<div id="algorithm_output">
    <div id="main_output">
        <table id="calculation">
            <thead>
                <tr>
                    <th>$D$</th>
                    <th></th>
                    <!-- ko foreach: input.sequence1 -->
                        <th data-bind="drawChar: [$data, $index()+1]"></th>
                    <!-- /ko -->
                </tr>
            </thead>

            <tbody>
                <!-- ko foreach: output.matrix --> <!-- to get i-indexes = $parentContext.$index() -->
                    <tr>
                        <!-- ko if: $index() == 0 -->
                            <th></th>
                        <!-- /ko -->

                        <!-- ko if: $index() > 0 -->
                            <th data-bind="drawChar: [$root.input.sequence2()[$index()-1], $index()]"></th>
                        <!-- /ko -->

                        <!-- ko foreach: $root.output.matrix[0] --> <!-- to get j-indexes = $index() -->
                            <td class="selectable_entry"
                                data-bind="text: $root.output.matrix()[$parentContext.$index()][$index()]"></td>
                        <!-- /ko -->
                    </tr>
                <!-- /ko -->

                <tr>
                    <th class="hint" colspan=100%>  <!-- HINT: move colspan into hint-class when browsers are ready! -->
                        <small>
                            <b>Score:</b> <span data-bind="text: $root.output.score"></span>
                        </small>
                    </th>
                </tr>
            </tbody>
        </table>

        <br>
        <table>
            <tfoot>
            <tr>
                <td class="download_table" colspan=100%>
                    <a class="table_download" href="#">Download Table</a>
                </td>
            </tr>
            </tfoot>
        </table>
    </div>

    <div id="ancillary_output">
        <div id ="outcome">
            <table id="results_header">
                <thead>
                    <tr>
                        <th>
                            Results <br>
                            <small>
                                You can select a result to get the related traceback.
                            </small>
                        </th>
                    </tr>
                </thead>
            </table>

            <div id="results_with_scrollbar">
                <table id="results">
                    <tbody>
                        <!-- ko foreach: $root.output.alignments -->
                            <!-- ko if: $index() < 10 -->
                                <!-- ko if: $index() == 0 -->
                                    <tr>
                                        <td class="selectable_entry selectable_entry_start">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                                <!-- ko if: $index() != 0 -->
                                    <tr>
                                        <td class="selectable_entry">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>

            <table id="results_footer">
                <tr>
                    <th>
                        <small>
                            <!-- ko if: $root.output.moreTracebacks -->
                                <b>Hint:</b> Only the first ten results are computed.
                            <!-- /ko -->
                        </small>
                    </th>
                </tr>
            </table>
        </div>
    </div>
</div>