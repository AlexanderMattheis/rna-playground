<!--
University of Freiburg WS 2017/2018
Chair for Bioinformatics
Supervisor: Martin Raden
Author: Alexander Mattheis
-->

<div id="algorithm_description">
  <div class="description">
      Different iterative refinement strategies were proposed to improve the Sum-of-Pairs score
      of a progressive alignment
      (e.g. an alignment created with
      <a href="http://rna.informatik.uni-freiburg.de/Teaching/index.jsp?toolName=Feng-Doolittle">Feng-Doolittle</a>)
      like Round-robin, in which the sequences are realigned in the order,
      they have been added to the multiple sequence alignment (using the guide-tree).
      If the score improves through the realignment,
      then the multi-sequence alignment is kept.
      And this approach can also be divided into different strategies:

      <ol>
          <li>
              <em>Minimum Distance-Pair:</em> From each aligned sequence remove gaps and realign immediately against
              the nearest sequence in the distance table you get from
              <a href="https://doi.org/10.1007/BF02603120">Feng-Doolittle (1987)</a> algorithm.
          </li>
          <li>
              <em>One-vs-All:</em> From each aligned sequence remove gaps and realign immediately against all
              using the progressive alignment procedure of
              <a href="https://doi.org/10.1007/BF02603120">Feng-Doolittle</a>.
          </li>
      </ol>

      In the following, we provide the series of accepted (score improving)
      iteratively computed intermediate realignments together with the guide tree used for realignment.
      The iterative refinement starts from an alignment computed with the
      <a href="http://rna.informatik.uni-freiburg.de/Teaching/index.jsp?toolName=Feng-Doolittle">Feng-Doolittle</a>
      algorithm.
  </div>

  <div class="picture">
      <img src="Iterative-Refinement-120x90.png" />
  </div>
</div>

<h1>Input:</h1>
<div id="algorithm_input">
    <div class="row">
        <div class="colW100"><label>Approach:</label></div>

        <div class="colW400">
            <select class="selector smaller" data-bind="options: input.availableApproaches, selectedOptions: input.selectedApproach"
                    id="approach_selector"></select>
        </div>
    </div>
    <br />
    <!-- ko foreach: $root.input.sequences() -->
        <div class="row">
            <div class="colW100">
                <label>
                    Sequence <span data-bind="text: $root.input.clusterNames()[$index()]"></span>:
                </label>
            </div>

            <div class="colW225">
                <input class="sequence_multi" data-bind="value: $data" placeholder="EXAMPLE 'ATC'" title="Allowed are A-Z and '-'." type="text">

                <!-- ko if: $index() == $root.input.clusterNames().length-1 -->
                    <div class="group_hint">
                        <b>Hints:</b> <br />
                        The "+" and "-" buttons can be used to add or remove sequences.
                        Duplicates of sequences are excluded from computations.
                        <!-- The distance formula
                        is not defined for two sequences of same type,
                        because the denominator gets zero.
                        Also, this allows a bigger code readability and runtime enhancement:
                        Sequences are stored as keys in hash-tables and
                        two times the same key is not possible in a hash-table!
                        -->
                    </div>
                <!-- /ko -->
            </div>

            <!-- ko if: $index() == $root.input.clusterNames().length-1 -->
                <button class="add_remove" data-bind="click: $root.input.addRow" title="Add Sequence" type="button">+</button>
            <!-- /ko -->

            <!-- ko if: $index() == $root.input.clusterNames().length-1 && $root.input.clusterNames().length > 2 -->
                <button class="add_remove" data-bind="click: $root.input.removeRow" title="Remove Sequence" type="button">-</button>
            <!-- /ko -->
        </div>
    <!-- /ko -->

    <div class="row">
		<div class="colW100"><label>Scoring in $s$:</label></div>

		<div class="colW400">
            <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                Match <input class="fx_parameter" data-bind="value: input.match" id="match" type="number">
                Mismatch <input class="fx_parameter" data-bind="value: input.mismatch" id="mismatch" type="number">
            </span>
		</div>
    </div>

    <div class="row">
		<div class="colW100"><label>Scoring in $g$:</label></div>

		<div class="colW400">
            <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                Gap opening $\alpha$ <input class="fx_parameter" data-bind="value: input.baseCosts" id="base_costs" type="number">
                Enlargement $\beta$ <input class="fx_parameter" data-bind="value: input.enlargement" id="enlargement" type="number">
            </span>
            <br />
            <br />
            <span data-bind="text: $root.input.gapFunction"></span>

            <div class="group_hint">
				<b>Hint:</b> <br />
				For similarity maximization, <br /> match scores should be positive and all other scores lower. <br />
			</div>
		</div>
    </div>
</div>

<h1>Output:</h1>
<div id="algorithm_output">
    <div class="final">
        <table class="final_result_header">
            <thead>
                <tr>
                    <th>
                        Final result
                    </th>
                </tr>
            </thead>
        </table>

        <div class="final_result_with_scrollbar">
            <table class="final_result">
                <tbody>
                    <tr>
                        <td class="entry entry_start">
                            <!-- ko foreach: $root.output.progressiveAlignment() -->
                                <code data-bind="text: $root.output.progressiveAlignment()[$index()]"></code> <br />
                            <!-- /ko -->
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <table class="final_result_footer">
            <tr>
                <th>
                    <small>
                        Affine SoP score: <span data-bind="text: $root.output.score()"></span>
                    </small>
                </th>
            </tr>
        </table>
    </div>

    <h2>Realignment steps</h2>
    <div class="merge_steps">
        <div class="result_with_scrollbar">
            <table class="result_categories top_border">
                <thead>
                    <tr>
                        <th>
                            <small><b>Removed Sequence</b></small>
                        </th>

                        <th>
                            <small><b>Remaining Alignment</b></small>
                        </th>

                        <th>
                            <small><b>Guide Alignment</b></small>
                        </th>

                        <th>
                             <small><b>Accepted Realignment</b></small>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <!-- ko foreach: $root.output.guideAlignments() -->
                        <tr>
                            <td class="entry entry_start">
                                <code data-bind="text: $root.output.firstGroupsNames()[$index()]"></code>: <br />
                                <!-- ko foreach: $root.output.firstGroups()[$index()] -->
                                    <code data-bind="text: $data"></code> <br />
                                <!-- /ko -->
                            </td>

                            <td class="entry entry_start">
                                <code data-bind="text: $root.output.secondGroupsNames()[$index()]"></code>: <br />
                                <!-- ko foreach: $root.output.secondGroups()[$index()] -->
                                    <code data-bind="text: $data"></code> <br />
                                <!-- /ko -->
                            </td>

                            <td class="entry entry_start">
                                <code data-bind="text: $root.output.guideAlignmentsNames()[$index()]"></code>: <br />
                                <code data-bind="text: $root.output.guideAlignments()[$index()][0]"></code> <br />
                                <code data-bind="text: $root.output.guideAlignments()[$index()][1]"></code> <br />
                                <code data-bind="text: $root.output.guideAlignments()[$index()][2]"></code>
                            </td>

                            <td class="entry entry_start">
                                <code data-bind="text: $root.output.joinedGroupNames()[$index()]"></code>: <br />
                                <!-- ko foreach: $root.output.joinedGroups()[$index()] -->
                                    <code data-bind="text: $data"></code> <br />
                                <!-- /ko -->
                            </td>
                        </tr>
                    <!-- /ko -->
                </tbody>
            </table>
        </div>
    </div>

    <h2>Phylogenetic Tree</h2>
    <div class="tree_container"> <!-- allows to delete and reinsert the div -->
        <div id="phylogenetic_tree"></div>
    </div>

    <!-- ko if: $root.output.newickString().length !== 1 && $root.output.newickString().indexOf(SYMBOLS.MINUS) === -1 -->
        <div class="group_hint">
            <b>Visualization done with</b> <br />
            Smits SA, Ouverney CC, 2010. jsPhyloSVG: <br />
            A Javascript Library for Visualizing Interactive and Vector-Based Phylogenetic Trees on the Web. <br />
            <a href="http://www.plosone.org/article/info:doi/10.1371/journal.pone.0012267">
                PLoS ONE 5(8): e12267. doi:10.1371/journal.pone.0012267
            </a>
        </div>
    <!-- /ko -->
</div>