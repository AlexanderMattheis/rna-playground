<!--
University of Freiburg WS 2017/2018
Chair for Bioinformatics
Supervisor: Martin Raden
Author: Alexander Mattheis
-->

<div id="algorithm_description">
    <div class="description">
        The dynamic programming approach by
        <a href=" https://doi.org/10.1093/bioinformatics/17.4.327">
            Abdullah N. Arslan, Ömer Eğecioğlu and Pavel A. Pevzner (2001)</a>
        computes the best normalized local alignments of two sequences.
        It identifies the alignment that is best preserved with respect to the length of both sequences.
        So, it finds the alignment with the highest similarity under the given sequence-lengths
        of sequences $a$ and $b$.
        <br>
        <br>
        To find a normalized local alignment,
        the Fractional Programming Algorithm by
        <a href="http://pubsonline.informs.org/doi/abs/10.1287/mnsc.13.7.492">Werner Dinkelbach (1967)</a>
        is together used with
        <a href="https://doi.org/10.1016/0022-2836(81)90087-5">Smith-Waterman (1981)</a>.
        A Fractional Programming Algorithm is a machine learning algorithm
        to solve problems in which the Objective Function $ns(\mathscr{A})$ is a fraction.
        <br>
        <br>
        The normalized local alignment algorithm tries
        to find the alignment $\mathscr{A}$ of two sequences
        which is producing the highest normalized score
        $$\lambda^* = ns(\mathscr{A}) = \frac{s(\mathscr{A})}{⟦A⟧ + L}$$
        where $⟦A⟧ = |a_i ... a_j| + |b_k ... b_l|$ is the alignment-length
        of the subsequences and $L$ is a parameter
        to control the dependence of the normalized similarity to the alignment-length.
        <br>
        <br>
        For computation the <a href="https://doi.org/10.1016/0022-2836(81)90087-5">Smith-Waterman</a>
        algorithm is executed iteratively with different parameters $\lambda$
        in the modified scoring-function $s'$
        and thereby the normalized score $\lambda$ is recomputed
        with <a href="http://pubsonline.informs.org/doi/abs/10.1287/mnsc.13.7.492">Dinkelbach</a>
        until the value $\lambda$ converges.
        <br>
        <br>
        The according iteration possibilities
        (different alignments produce different iterations)
        can be selected below.
        For a given input, the according tables and scoring functions for $S$
        are shown along with a list of according local alignments.
        On table cell selection, optimal traceback options are shown.
        On alignment selection, an according traceback path is visualized in the table.
    </div>

    <div class="picture">
        <img src="Arslan-Egecioglu-Pevzner-120x90.png">
    </div>
</div>

<div id="algorithm_input">
    <form>
        <p>
            <label>Sequence $a$:</label>
            <input class="sequence" data-bind="value: input.sequence1" id="sequence_1"
                   placeholder="EXAMPLE 'ATC'" type="text">
        </p>

        <p>
            <label>Sequence $b$:</label>
            <input class="sequence" data-bind="value: input.sequence2" id="sequence_2"
                   placeholder="EXAMPLE 'AGTC'" type="text">
        </p>

        <p>
            <label>Scoring in $s'$:</label>
            <div class="span_group">
                <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                    Match <input class="fx_parameter" data-bind="value: input.match" id="match" type="number">
                    Mismatch <input class="fx_parameter" data-bind="value: input.mismatch" id="mismatch" type="number">
                </span>
                <br>
                <br>
                <span class="group"> <!-- Microsoft Browsers will fallback on text-fields using following input type -->
                     Deletion <input class="fx_parameter" data-bind="value: input.deletion" id="deletion" type="number">
                     Insertion <input class="fx_parameter" data-bind="value: input.insertion" id="insertion" type="number">
                     Length $L$ <input class="fx_parameter" data-bind="value: input.length" id="length" type="number">
                </span>
            </div>
        </p>

        <p>
            <label id="recursion_arslan_egecioglu_pevzner">Recursion:</label>
            <div class="span_group">
                <span data-bind="text: $root.input.formula"></span>
                <br>
                <br>
                with <br>
                <span data-bind="text: $root.input.subFormula"></span>
                <br>
                <br>
                where $\lambda_0 = 0$
                <br>
                <br>
            </div>

            <div class="group_hint">
                <b>Hint:</b> <br>
                For similarity maximization, match scores should be positive and all other scores lower. <br>
            </div>
        </p>
    </form>
</div>

<div id="algorithm_output">
    <div class="output">
        <div class="main_output">
            <table class="calculation">
                <thead>
					<tr>
						<th>$D$</th>
						<th></th>
                        <!-- ko foreach: input.sequence1 -->
							<th data-bind="drawChar: [$data, $index()+1]"></th>
                        <!-- /ko -->
					</tr>
                </thead>

                <tbody>
					<!-- ko foreach: output.matrix --> <!-- to get i-indexes = $parentContext.$index() -->
						<tr>
							<!-- ko if: $index() == 0 -->
								<th></th>
                            <!-- /ko -->

                            <!-- ko if: $index() > 0 -->
								<th data-bind="drawChar: [$root.input.sequence2()[$index()-1], $index()]"></th>
                            <!-- /ko -->

                            <!-- ko foreach: $root.output.matrix[0] --> <!-- to get j-indexes = $index() -->
								<td class="selectable_entry"
                                    data-bind="text: $root.output.matrix()[$parentContext.$index()][$index()]"></td>
                            <!-- /ko -->
						</tr>
                    <!-- /ko -->

					<tr>
						<th class="hint" colspan=100%>  <!-- HINT: move colspan into "hint"-class when browsers are ready! -->
							<small>
								<b>Score:</b> <span data-bind="text: $root.output.score"></span>
							</small>
						</th>
					</tr>
                </tbody>
            </table>
        </div>

        <div class="download">
            <table>
                <tfoot>
                    <tr>
                        <td class="download_table" colspan=100%>
                            <a class="table_download" href="#">Download Table</a>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="outcome">
        <div class ="ancillary_output">
            <table class="results_header">
                <thead>
					<tr>
						<th>
							Results <br>
							<small>
								You can select a result to get the related traceback.
							</small>
						</th>
					</tr>
                </thead>
            </table>

            <div class="results_with_scrollbar">
                <table class="results">
                    <tbody>
                        <!-- ko foreach: $root.output.alignments -->
                            <!-- ko if: $index() < 10 -->
                                <!-- ko if: $index() == 0 -->
                                    <tr>
                                        <td class="selectable_entry selectable_entry_start">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                                <!-- ko if: $index() != 0 -->
                                    <tr>
                                        <td class="selectable_entry">
                                            <code data-bind="text: $root.output.alignments()[$index()][0]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][1]"></code> <br>
                                            <code data-bind="text: $root.output.alignments()[$index()][2]"></code>
                                        </td>
                                    </tr>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>

            <table class="results_footer">
                <tr>
                    <th>
                        <small>
                            <!-- ko if: $root.output.moreTracebacks -->
                                <b>Hint:</b> Only the first ten results are computed.
                            <!-- /ko -->
                        </small>
                    </th>
                </tr>
            </table>
        </div>
    </div>
</div>
